<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="assets/css/theme-merged.css" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0f172a">
    <style>
        body { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); color: #232946; }
        .glass-container { background: rgba(255,255,255,0.85); backdrop-filter: blur(20px); border-radius: 16px; padding: 2rem; border: 1px solid #e5e7eb; }
        .logo { font-size: 1.8rem; font-weight: 900; color: #647dee; }
        .page-title { text-align: center; padding: 60px 0 40px; }
        .page-title h1 { font-size: 2.8rem; font-weight: 900; }
        .page-subtitle { color: #647dee; }
        .registration-form { max-width: 700px; margin: 0 auto; }
        .form-control, .form-select { background: rgba(100,125,222,0.04); border: 1px solid #e5e7eb; color: #232946; }
        .register-btn { display: inline-block; padding: 14px 28px; border-radius: 12px; background: linear-gradient(90deg,#7f53ac,#647dee); color: #fff; font-weight: 700; border: none; }
        .register-btn:hover { transform: translateY(-2px); }
        #checkEligibilityBtn { position: relative; z-index: 9999; pointer-events: auto; }
        .benefits-section { background: rgba(100,125,222,0.06); padding: 1rem; border-radius: 10px; margin-bottom: 1rem; }
        .floating-cta { position: fixed; right: 20px; bottom: 24px; z-index: 10001; width: 56px; height: 56px; border-radius: 999px; background: linear-gradient(90deg,#7f53ac,#647dee); color: #fff; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: none; cursor: pointer; }
        .login-link { text-align:center; margin-top: 1.5rem; }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center py-3">
                <div class="logo">APP</div>
                <a href="index.html" class="text-white-50">Back to Home</a>
            </div>
        </div>
    </header>

    <div class="page-title">
        <div class="container">
            <h1>Create Your Account</h1>
            <p class="page-subtitle">Join thousands of satisfied customers</p>
        </div>
    </div>

    <div class="container mb-5">
        <div class="glass-container">
            <div class="registration-form">
                <div class="row">
                    <div class="col-md-6">
                        <h5 style="color:#647dee;">Why Choose Us?</h5>
                        <div class="benefits-section">
                            <div class="mb-2"><i class="fas fa-bolt me-2"></i>Fast and easy registration</div>
                            <div class="mb-2"><i class="fas fa-mobile-alt me-2"></i>Mobile-friendly and accessible</div>
                            <div class="mb-2"><i class="fas fa-shield-alt me-2"></i>100% secure with modern encryption</div>
                            <div class="mb-2"><i class="fas fa-money-bill-wave me-2"></i>Flexible account options</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <form id="registerForm">
                            <div class="mb-2">
                                <label class="form-label">First Name</label>
                                <input id="firstName" class="form-control" placeholder="First name" />
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Last Name</label>
                                <input id="lastName" class="form-control" placeholder="Last name" />
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Phone</label>
                                <input id="phoneNumber" class="form-control" placeholder="254712345678 or 0712345678" />
                            </div>
                            <div class="mb-2">
                                <label class="form-label">ID Number</label>
                                <input id="idNumber" class="form-control" placeholder="National ID number" />
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Date of Birth</label>
                                <input id="dateOfBirth" type="date" class="form-control" />
                            </div>
                            <div class="d-flex gap-2 mt-3">
                                <button type="button" id="checkEligibilityBtn" class="register-btn">Check Eligibility</button>
                                <button type="submit" class="btn btn-outline-light">Create Account</button>
                            </div>
                            <div class="login-link"><p>Already have an account? <a href="#" onclick="showLogin()">Sign In</a></p></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="checkEligibilityFloat" class="floating-cta" aria-label="Check Eligibility" title="Check Eligibility"><i class="fas fa-search"></i></button>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function validatePhoneNumber(phone) {
            phone = (phone||'').replace(/[\\s\\-\\+]/g, '');
            if (phone.startsWith('254') && phone.length === 12) return phone;
            if (phone.startsWith('07') && phone.length === 10) return '254' + phone.substring(1);
            if (phone.startsWith('7') && phone.length === 9) return '254' + phone;
            return null;
        }

        function showLogin() {
            Swal.fire({
                title: 'Sign In to Your Account',
                html: `
                    <input id="loginPhone" class="swal2-input" placeholder="254712345678">
                    <input id="loginPassword" type="password" class="swal2-input" placeholder="Password">
                `,
                confirmButtonText: 'Sign In',
                showCancelButton: true,
                preConfirm: () => {
                    const phone = document.getElementById('loginPhone').value;
                    const password = document.getElementById('loginPassword').value;
                    if (!phone || !password) { Swal.showValidationMessage('Please fill in all fields'); return false; }
                    sessionStorage.setItem('isLoggedIn','true');
                    return { phone };
                }
            }).then((r) => { if (r.isConfirmed) { window.location.href = 'apply.html'; } });
        }

        function checkEligibility() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const phoneRaw = document.getElementById('phoneNumber').value.trim();
            const idNum = document.getElementById('idNumber').value.trim();
            const dob = document.getElementById('dateOfBirth').value;

            const missing = [];
            if (!firstName) missing.push('firstName');
            if (!lastName) missing.push('lastName');
            if (!validatePhoneNumber(phoneRaw)) missing.push('phone');
            if (!/^[0-9]{1,8}$/.test(idNum)) missing.push('idNum');
            if (!dob) missing.push('dob');

            if (missing.length > 0) {
                const params = new URLSearchParams();
                params.set('missing', missing.join(','));
                if (firstName) params.set('firstName', firstName);
                if (lastName) params.set('lastName', lastName);
                if (phoneRaw) params.set('phone', phoneRaw);
                if (idNum) params.set('idNum', idNum);
                if (dob) params.set('dob', dob);
                window.location.href = 'fill-info.html?' + params.toString();
                return;
            }

            fetch('/api/check-eligibility', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ firstName, lastName, phone: phoneRaw, idNum, dob })
            }).then(r => r.json()).then(json => {
                if (!json || !json.success) { Swal.fire({ icon: 'error', title: 'Service Error', text: 'Eligibility service error. Please try again.' }); return; }
                if (json.eligible) { Swal.fire({ icon: 'success', title: 'Pre-Eligibility OK', text: 'You appear eligible to apply.' }).then(() => { window.location.href = 'apply.html'; }); }
                else { Swal.fire({ icon: 'info', title: 'Not Eligible', text: json.reason || 'You do not meet our pre-eligibility criteria.' }); }
            }).catch(err => { console.error(err); Swal.fire({ icon: 'error', title: 'Network Error', text: 'Could not contact eligibility service.' }); });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const btn = document.getElementById('checkEligibilityBtn');
            if (btn) btn.addEventListener('click', function(e){ e.preventDefault(); checkEligibility(); });
            const f = document.getElementById('checkEligibilityFloat');
            if (f) f.addEventListener('click', function(e){ e.preventDefault(); checkEligibility(); });
            document.getElementById('registerForm').addEventListener('submit', function(e){ e.preventDefault(); alert('Create account flow is disabled in this demo â€” use Check Eligibility.'); });
        });
    </script>
</body>
</html>